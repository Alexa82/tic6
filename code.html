<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aventura no Mundo Digital</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Arial', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
            height: 100vh;
        }

        #gameCanvas {
            display: block;
            margin: 0 auto;
            background: #1a1a2e;
            box-shadow: 0 10px 50px rgba(0,0,0,0.5);
        }

        #ui {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            color: white;
            width: 90%;
            max-width: 800px;
        }

        .menu-screen, .game-over-screen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(26, 26, 46, 0.95);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            color: white;
            min-width: 400px;
            box-shadow: 0 0 30px rgba(102, 126, 234, 0.5);
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        h2 {
            font-size: 1.8em;
            margin-bottom: 15px;
            color: #ffd700;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: bold;
        }

        button:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.6);
        }

        .score-display {
            font-size: 1.5em;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .controls-info {
            margin-top: 20px;
            font-size: 0.9em;
            color: #aaa;
        }

        .level-indicator {
            font-size: 1.2em;
            color: #4ecdc4;
            margin-left: 20px;
        }

        .instruction {
            background: rgba(78, 205, 196, 0.2);
            padding: 10px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 1em;
        }

        @media (max-width: 600px) {
            .menu-screen, .game-over-screen {
                min-width: 90%;
                padding: 20px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            button {
                padding: 12px 30px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="ui">
        <div class="score-display">
            Pontos: <span id="score">0</span>
            <span class="level-indicator">Nível: <span id="level">1</span></span>
        </div>
    </div>

    <script>
        // Sistema de áudio
        const AudioSystem = {
            context: null,
            
            init() {
                this.context = new (window.AudioContext || window.webkitAudioContext)();
            },
            
            playSound(frequency, duration, type = 'sine') {
                if (!this.context) this.init();
                const oscillator = this.context.createOscillator();
                const gainNode = this.context.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.context.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = type;
                
                gainNode.gain.setValueAtTime(0.3, this.context.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.context.currentTime + duration);
                
                oscillator.start(this.context.currentTime);
                oscillator.stop(this.context.currentTime + duration);
            },
            
            playCorrect() {
                this.playSound(523.25, 0.2);
                setTimeout(() => this.playSound(659.25, 0.2), 100);
                setTimeout(() => this.playSound(783.99, 0.3), 200);
            },
            
            playWrong() {
                this.playSound(200, 0.15);
                setTimeout(() => this.playSound(150, 0.3), 150);
            },
            
            playClick() {
                this.playSound(300, 0.1);
            },
            
            playLevelUp() {
                for(let i = 0; i < 5; i++) {
                    setTimeout(() => this.playSound(400 + i * 100, 0.1), i * 80);
                }
            }
        };

        // Perguntas do jogo
        const questions = [
            // Nível 1 - Básico
            {
                question: "O que é o Hardware?",
                options: ["A parte física do computador", "Os programas do computador", "A internet", "Um jogo"],
                correct: 0,
                explanation: "Hardware são as peças físicas que podes ver e tocar!",
                level: 1
            },
            {
                question: "O que é o Software?",
                options: ["Uma peça física", "Os programas e instruções", "Um cabo", "Um ecrã"],
                correct: 1,
                explanation: "Software são os programas que dizem ao hardware o que fazer!",
                level: 1
            },
            {
                question: "Qual é o 'cérebro' do computador?",
                options: ["Rato", "CPU", "Teclado", "Monitor"],
                correct: 1,
                explanation: "O CPU (processador) é o cérebro que faz todos os cálculos!",
                level: 1
            },
            {
                question: "O que faz a RAM?",
                options: ["Guarda permanentemente", "Memória de trabalho temporária", "Mostra imagens", "Faz sons"],
                correct: 1,
                explanation: "A RAM é como uma secretária que guarda o que estás a usar agora!",
                level: 1
            },
            
            // Nível 2 - Intermédio
            {
                question: "O que liga todos os componentes do computador?",
                options: ["CPU", "RAM", "Motherboard", "HDD"],
                correct: 2,
                explanation: "A Motherboard é como a cidade que liga todas as peças!",
                level: 2
            },
            {
                question: "Qual armazena dados permanentemente?",
                options: ["RAM", "CPU", "Disco Rígido (HDD)", "Motherboard"],
                correct: 2,
                explanation: "O Disco Rígido guarda tudo mesmo depois de desligar!",
                level: 2
            },
            {
                question: "O que é mais rápido?",
                options: ["HDD", "SSD", "RAM", "CPU"],
                correct: 1,
                explanation: "O SSD não tem peças mecânicas e é super rápido!",
                level: 2
            },
            {
                question: "O que desenha as imagens no ecrã?",
                options: ["CPU", "RAM", "Placa Gráfica", "HDD"],
                correct: 2,
                explanation: "A Placa Gráfica é o artista que desenha tudo no monitor!",
                level: 2
            },
            
            // Nível 3 - Avançado
            {
                question: "A velocidade do CPU mede-se em:",
                options: ["GB", "GHz", "TB", "MB"],
                correct: 1,
                explanation: "GHz (gigahertz) mede quantas operações faz por segundo!",
                level: 3
            },
            {
                question: "A RAM perde os dados quando:",
                options: ["Abres um programa", "Desligas o PC", "Guardas um ficheiro", "Jogas um jogo"],
                correct: 1,
                explanation: "A RAM é temporária e apaga tudo ao desligar!",
                level: 3
            },
            {
                question: "O que fornece energia ao computador?",
                options: ["Motherboard", "CPU", "Fonte de Alimentação", "RAM"],
                correct: 2,
                explanation: "A Fonte de Alimentação é o coração elétrico do PC!",
                level: 3
            },
            {
                question: "Hardware e Software são:",
                options: ["Inimigos", "Independentes", "Inseparáveis", "Iguais"],
                correct: 2,
                explanation: "São como o corpo e a mente - precisam um do outro!",
                level: 3
            }
        ];

        // Classe principal do jogo
        class Game {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.gameState = 'menu';
                this.score = 0;
                this.level = 1;
                this.currentQuestion = 0;
                this.selectedAnswer = -1;
                this.showingExplanation = false;
                this.answerCorrect = false;
                this.particles = [];
                this.stars = [];
                this.highScore = parseInt(localStorage.getItem('techGameHighScore')) || 0;
                
                this.setupCanvas();
                this.setupInput();
                this.initStars();
                this.showMenu();
                this.gameLoop();
            }

            setupCanvas() {
                const setCanvasSize = () => {
                    const maxWidth = Math.min(window.innerWidth - 40, 900);
                    const maxHeight = Math.min(window.innerHeight - 100, 600);
                    this.canvas.width = maxWidth;
                    this.canvas.height = maxHeight;
                };
                
                setCanvasSize();
                window.addEventListener('resize', setCanvasSize);
            }

            setupInput() {
                this.keys = {};
                this.mouse = { x: 0, y: 0, pressed: false };
                this.touch = { x: 0, y: 0, active: false };

                document.addEventListener('keydown', (e) => {
                    this.keys[e.code] = true;
                    if (this.gameState === 'playing' && !this.showingExplanation) {
                        if (e.code === 'Digit1' || e.code === 'Numpad1') this.selectAnswer(0);
                        if (e.code === 'Digit2' || e.code === 'Numpad2') this.selectAnswer(1);
                        if (e.code === 'Digit3' || e.code === 'Numpad3') this.selectAnswer(2);
                        if (e.code === 'Digit4' || e.code === 'Numpad4') this.selectAnswer(3);
                    }
                    if (e.code === 'Space' && this.showingExplanation) {
                        this.nextQuestion();
                    }
                });

                document.addEventListener('keyup', (e) => {
                    this.keys[e.code] = false;
                });

                this.canvas.addEventListener('click', (e) => {
                    const rect = this.canvas.getBoundingClientRect();
                    this.mouse.x = (e.clientX - rect.left) * (this.canvas.width / rect.width);
                    this.mouse.y = (e.clientY - rect.top) * (this.canvas.height / rect.height);
                    this.handleClick();
                });

                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const rect = this.canvas.getBoundingClientRect();
                    const touch = e.touches[0];
                    this.touch.x = (touch.clientX - rect.left) * (this.canvas.width / rect.width);
                    this.touch.y = (touch.clientY - rect.top) * (this.canvas.height / rect.height);
                    this.mouse.x = this.touch.x;
                    this.mouse.y = this.touch.y;
                    this.handleClick();
                });
            }

            initStars() {
                for (let i = 0; i < 100; i++) {
                    this.stars.push({
                        x: Math.random() * this.canvas.width,
                        y: Math.random() * this.canvas.height,
                        size: Math.random() * 2,
                        speed: Math.random() * 0.5 + 0.1
                    });
                }
            }

            showMenu() {
                this.gameState = 'menu';
                const menuHTML = `
                    <div class="menu-screen">
                        <h1>🖥️ Aventura no Mundo Digital 🖥️</h1>
                        <p class="instruction">Aprende sobre Hardware e Software!</p>
                        <button onclick="game.startGame()">Começar Aventura</button>
                        <div class="controls-info">
                            <p><strong>Como Jogar:</strong></p>
                            <p>Clica nas respostas ou usa as teclas 1, 2, 3, 4</p>
                            <p>Responde corretamente para ganhar pontos!</p>
                            <p><strong>Recorde:</strong> ${this.highScore} pontos</p>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', menuHTML);
            }

            startGame() {
                AudioSystem.playClick();
                document.querySelector('.menu-screen')?.remove();
                this.gameState = 'playing';
                this.score = 0;
                this.level = 1;
                this.currentQuestion = 0;
                this.updateUI();
                this.loadQuestion();
            }

            loadQuestion() {
                if (this.currentQuestion >= questions.length) {
                    this.gameOver(true);
                    return;
                }

                this.selectedAnswer = -1;
                this.showingExplanation = false;
                
                const question = questions[this.currentQuestion];
                if (question.level > this.level) {
                    this.level = question.level;
                    AudioSystem.playLevelUp();
                    this.createCelebrationParticles();
                }
                
                this.updateUI();
            }

            selectAnswer(index) {
                if (this.showingExplanation) return;
                
                AudioSystem.playClick();
                this.selectedAnswer = index;
                const question = questions[this.currentQuestion];
                this.answerCorrect = index === question.correct;
                
                if (this.answerCorrect) {
                    AudioSystem.playCorrect();
                    this.score += this.level * 10;
                    this.createParticles(this.canvas.width / 2, this.canvas.height / 2, '#4ecdc4');
                } else {
                    AudioSystem.playWrong();
                }
                
                this.showingExplanation = true;
                this.updateUI();
            }

            nextQuestion() {
                AudioSystem.playClick();
                this.currentQuestion++;
                this.loadQuestion();
            }

            handleClick() {
                if (this.gameState !== 'playing') return;

                if (this.showingExplanation) {
                    this.nextQuestion();
                    return;
                }

                const question = questions[this.currentQuestion];
                const buttonHeight = 60;
                const buttonSpacing = 70;
                const startY = this.canvas.height / 2;

                for (let i = 0; i < question.options.length; i++) {
                    const y = startY + i * buttonSpacing;
                    if (this.mouse.y > y && this.mouse.y < y + buttonHeight) {
                        this.selectAnswer(i);
                        break;
                    }
                }
            }

            createParticles(x, y, color) {
                for (let i = 0; i < 30; i++) {
                    this.particles.push({
                        x: x,
                        y: y,
                        vx: (Math.random() - 0.5) * 8,
                        vy: (Math.random() - 0.5) * 8,
                        life: 1,
                        color: color
                    });
                }
            }

            createCelebrationParticles() {
                for (let i = 0; i < 50; i++) {
                    this.particles.push({
                        x: this.canvas.width / 2,
                        y: this.canvas.height / 2,
                        vx: (Math.random() - 0.5) * 10,
                        vy: (Math.random() - 0.5) * 10,
                        life: 1,
                        color: ['#ffd700', '#4ecdc4', '#ff6b6b'][Math.floor(Math.random() * 3)]
                    });
                }
            }

            updateUI() {
                document.getElementById('score').textContent = this.score;
                document.getElementById('level').textContent = this.level;
            }

            gameOver(completed = false) {
                this.gameState = 'gameover';
                
                if (this.score > this.highScore) {
                    this.highScore = this.score;
                    localStorage.setItem('techGameHighScore', this.highScore);
                }

                const message = completed ? 
                    '🎉 Parabéns! Completaste todas as perguntas!' : 
                    '😢 Fim do Jogo!';

                const gameOverHTML = `
                    <div class="game-over-screen">
                        <h1>${message}</h1>
                        <h2>Pontuação Final: ${this.score}</h2>
                        <h2>Recorde: ${this.highScore}</h2>
                        <p class="instruction">Aprendeste muito sobre Hardware e Software!</p>
                        <button onclick="game.startGame()">Jogar Outra Vez</button>
                        <button onclick="location.reload()">Menu Principal</button>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', gameOverHTML);
            }

            update(deltaTime) {
                // Atualizar estrelas
                this.stars.forEach(star => {
                    star.y += star.speed;
                    if (star.y > this.canvas.height) {
                        star.y = 0;
                        star.x = Math.random() * this.canvas.width;
                    }
                });

                // Atualizar partículas
                this.particles = this.particles.filter(p => {
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.2;
                    p.life -= 0.02;
                    return p.life > 0;
                });
            }

            render() {
                // Limpar canvas
                this.ctx.fillStyle = '#1a1a2e';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                // Desenhar estrelas
                this.stars.forEach(star => {
                    this.ctx.fillStyle = 'white';
                    this.ctx.fillRect(star.x, star.y, star.size, star.size);
                });

                // Desenhar partículas
                this.particles.forEach(p => {
                    this.ctx.fillStyle = p.color;
                    this.ctx.globalAlpha = p.life;
                    this.ctx.fillRect(p.x, p.y, 4, 4);
                });
                this.ctx.globalAlpha = 1;

                if (this.gameState === 'playing') {
                    this.renderQuestion();
                }
            }

            renderQuestion() {
                const question = questions[this.currentQuestion];
                const centerX = this.canvas.width / 2;

                // Desenhar pergunta
                this.ctx.fillStyle = 'white';
                this.ctx.font = 'bold 24px Arial';
                this.ctx.textAlign = 'center';
                const words = question.question.split(' ');
                let line = '';
                let y = 80;
                
                words.forEach(word => {
                    const testLine = line + word + ' ';
                    const metrics = this.ctx.measureText(testLine);
                    if (metrics.width > this.canvas.width - 100) {
                        this.ctx.fillText(line, centerX, y);
                        line = word + ' ';
                        y += 30;
                    } else {
                        line = testLine;
                    }
                });
                this.ctx.fillText(line, centerX, y);

                // Desenhar opções
                const buttonHeight = 60;
                const buttonWidth = Math.min(600, this.canvas.width - 100);
                const buttonSpacing = 70;
                const startY = this.canvas.height / 2;

                question.options.forEach((option, i) => {
                    const x = centerX - buttonWidth / 2;
                    const y = startY + i * buttonSpacing;

                    // Cor do botão
                    if (this.showingExplanation) {
                        if (i === question.correct) {
                            this.ctx.fillStyle = '#4ecdc4';
                        } else if (i === this.selectedAnswer) {
                            this.ctx.fillStyle = '#ff6b6b';
                        } else {
                            this.ctx.fillStyle = '#555';
                        }
                    } else if (i === this.selectedAnswer) {
                        this.ctx.fillStyle = '#667eea';
                    } else {
                        this.ctx.fillStyle = '#444';
                    }

                    // Desenhar botão
                    this.ctx.fillRect(x, y, buttonWidth, buttonHeight);
                    
                    // Borda
                    this.ctx.strokeStyle = '#fff';
                    this.ctx.lineWidth = 2;
                    this.ctx.strokeRect(x, y, buttonWidth, buttonHeight);

                    // Texto
                    this.ctx.fillStyle = 'white';
                    this.ctx.font = '18px Arial';
                    this.ctx.fillText(`${i + 1}. ${option}`, centerX, y + 35);
                });

                // Mostrar explicação
                if (this.showingExplanation) {
                    const explanationY = startY + question.options.length * buttonSpacing + 20;
                    
                    this.ctx.fillStyle = this.answerCorrect ? '#4ecdc4' : '#ff6b6b';
                    this.ctx.font = 'bold 22px Arial';
                    this.ctx.fillText(
                        this.answerCorrect ? '✓ Correto!' : '✗ Errado!',
                        centerX,
                        explanationY
                    );

                    this.ctx.fillStyle = 'white';
                    this.ctx.font = '18px Arial';
                    this.ctx.fillText(question.explanation, centerX, explanationY + 35);
                    
                    this.ctx.font = '16px Arial';
                    this.ctx.fillStyle = '#aaa';
                    this.ctx.fillText('(Clica ou prime ESPAÇO para continuar)', centerX, explanationY + 65);
                }
            }

            gameLoop() {
                const now = Date.now();
                const deltaTime = (now - (this.lastTime || now)) / 16.67;
                this.lastTime = now;

                this.update(deltaTime);
                this.render();

                requestAnimationFrame(() => this.gameLoop());
            }
        }

        // Iniciar jogo
        let game;
        window.addEventListener('DOMContentLoaded', () => {
            game = new Game();
        });
    </script>
</body>
</html>
